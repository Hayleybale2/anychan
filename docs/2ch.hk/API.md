# 2ch.hk API

## Все посты из треда

Страница треда:
https://2ch.hk/<доска>/res/<номер-треда>.html

JSON API:
https://2ch.hk/<доска>/res/<номер-треда>.json

Ответ:

```js
{
  "Board": "vg",
  "BoardInfo": "Доска для постоянных тредов по игре",
  "BoardInfoOuter": "Видеоигры, general, официальные треды", // хз
  "BoardName": "Video Games General",
  "current_thread": "id запрошенного треда",
  "default_name": "Аноним",
  "posts_count": 123, // количество постов в треде
  "threads": [{
    "posts": [] // массив объектов типа `post`.
  }],
  "title": "...", // видимо, то же самое, что `posts[0].subject`
  "unique_posters": 7, // возможно, количество уникальных пользователей, написавших комментарий в треде.
  "files_count": 3, // сколько файлов прикреплено к постам треда суммарно
  "bump_limit": 1000, // сколько постов можно написать в тред до тех пор, пока он не перестанет от них "бампаться" (подниматься).
  "is_board": 0, // хз
  "is_closed": 0, // is the thread open or closed for comments
  "is_index": 0,
  "max_comment": 15000, // max comment length
  "max_files_size": 40960, // max attachment size
  "max_num": 3489385, // id самого "последнего" (на текущий момент) поста в треде.
  "board_banner_image": "/ololo/kpop_7.gif", // баннер случайной доски
  "board_banner_link": "kpop", // ссылка баннера случайной доски
}
```

Объект типа `post`:

```js
{
  "banned": 0, // забанен ли автор поста
  "closed": 0, // закрыт ли тред
  "comment": "...", // HTML код комментария
  "date": "01/02/19 Птн 18:35:24", // "человекочитаемая" дата написания поста
  "email": "", // "email" автора поста (с префиксом "mailto:"). пример: "mailto:sage".
  "endless": 0, // "не тонущие" треды помечены единицей
  "files": [{
    "displayname": "photo2018-10-27[...]..png", // имя файла (ограниченное по длине)
    "fullname": "photo2018-10-2705-29-50.png", // имя файла
    "height": 768, // высота картинки или видео
    "md5": "bc441048422b76dd41d626e1420fa0f7", // MD5 хеш файла
    "name": "15490353246680.png", // имя файла на сервере
    "nsfw": 0, // помечена ли эта картинка как "NSFW" (18+)
    "path": "/vg/src/29102706/15490353246680.png", // URL картинки или видео
    "size": 1611, // размер (в килобайтах) картинки или видео
    "thumbnail": "/vg/thumb/29102706/15490353246680s.jpg", // URL уменьшенной картинки
    "tn_height": 140, // высота уменьшенной картинки
    "tn_width": 250, // ширина уменьшенной картинки
    "type": 2, // тип файла (1 — jpeg, 2 — png, 4 — gif, 6 - webm, 10 — mp4, 100 — png стикер)
    "width": 1363, // ширина картинки или видео
    // Только для видео:
    "duration": "00:00:53", // "человекочитаемая" длительность ролика
    "duration_secs": 53 // длительность ролика в секундах
  }],
  "enable_likes": 0, // ставятся ли в этом треде лайки.
  "enable_posting": 1, // хз
  // "enable_images", "enable_video", ...
  "lasthit": 1549117714, // timestamp комментария, который является (на текущее время) "последним", "бампающим" данный тред; например, 500-ый комментарий в треде (или последний текущий, если меньше "бамп лимита" в треде).
  "name": "Аноним", // имя автора
  "num": 29102706, // id поста
  "number": 1, // порядковый номер поста в треде
  "op": 0, // пост написал человек, создавший тред, или нет. хз, как это работает, т.к. оно не всегда работает. например, первый пост треда может быть помечен как `"op": 0`.
  "parent": "0", // id поста, ответом на который является этот пост
  "sticky": 0, // закреплён ли этот тред наверху в списке тредов доски. если не ноль, то будет порядковый номер закреплённого поста ("1" будет выше "2").
  "subject": "Четырнадцатый двачкап", // "тема" поста
  "tags": "lolcup",
  "timestamp": 1549035324, // когда был отправлен пост (unix time)
  "trip": "", // "трип-код"; для администраторов и модераторов тут ставится соответствующая метка
  // Иногда бывают ещё:
  "likes": 1, // количество "лайков"
  "dislikes": 1, // количество "дизлайков"
}

  originalPoster: post.op === 1 // unreliable, can be `post.op` === 0 for the opening post.
}
```

## Все посты из треда, начиная с id поста

JSON API:
https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=1&num=1

`board` — доска

`thread` - id треда

`num` — id поста, начиная с корого будет список постов в ответе.

Ответ: массив объектов типа `post` (см. выше).

## Все посты из треда, начиная с порядкового номера поста в треде

JSON API:
https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=39220&post=252

`board` — доска

`thread` - id треда

`num` — порядковый номер поста в треде, начиная с корого будет список постов в ответе.

Ответ: массив объектов типа `post` (см. выше).

## Список тредов доски

https://2ch.hk/<доска>/<номер-страницы>.json

(первая страница: `index`, а не `0`)

```js
{
  "pages": [0, 1, 2, 3, ...],
  "threads": [{
    "posts_count": 27,
    "thread_num": "3475861",
    "posts": [...]
  }]
}
```

## Список тредов доски с сортировкой по дате последнего поста

(выводит список тредов, упорядоченных по дате "последнего" (на текущий момент) поста в них (самые новые — сверху); "тред" — в данном случае первый пост треда)

https://2ch.hk/<доска>/catalog.json

```js
{
  "threads": [{
    "banned": 0,
    "closed": 0,
    "comment": "Здесь все реквесты, поиск желаемых&#47;забытых игр, вот это всё.",
    "date": "30/05/17 Втр 22:35:38",
    "email": "",
    "endless": 1,
    "files": [...]

    "files_count": 164,
    "lasthit": 1541026424,
    "name": "Аноним",
    "num": "2080955",
    "op": 0,
    "parent": "0",
    "posts_count": 1538,
    "sticky": 2,
    "subject": "Единый поиска игор тред ",
    "timestamp": 1496172938,
  }]
}
```

Случайные баннеры:

```js
"board_banner_image": "/ololo/ukr_5.jpg",
"board_banner_link": "ukr",
```

## Список тредов доски с сортировкой по времени создания треда

https://2ch.hk/<доска>/catalog_num.json

## Список тредов доски (облегченный вариант, с просмотрами и рейтингом для "топа тредов")

https://2ch.hk/<доска>/threads.json

```js
{
  threads: [{
    "comment": "ИТТ описываем свои похождения, делимся впечатлениями, постим скриншоты и видео. Закатный: <a href=\"/v/res/3463920.html#3463920\" class=\"post-reply-link\" data-thread=\"3463920\" data-num=\"3463920\">>>3463920 (OP)</a>",
    "lasthit": 1541028071,
    "num": "3475861",
    "posts_count": 374,
    "score": 17.8347107438, // рейтинг треда
    "subject": "Во что играем?",
    "timestamp": 1540597950,
    "views": 2159 // количество просмотров
  },
  ...]
}
```

## Список досок

https://2ch.hk/boards.json

```js
{
  "global_boards": 158,
  "global_posts": "363,061,097\u0000",
  "global_speed": "1,406\u0000",
  "is_index": 1,
  "boards": [
    {
      "bump_limit": 500,
      "category": "Разное",
      "default_name": "Аноним",
      "enable_names": 0,
      "enable_sage": 1,
      "id": "b",
      "info": "бред",
      "last_num": 190778973,
      "name": "Бред",
      "speed": 2690,
      "threads": 210,
      "unique_posters": 4137
    },
    {
      "bump_limit": 500,
      "category": "Взрослым",
      "default_name": "Аноним",
      "enable_names": 1,
      "enable_sage": 1,
      "id": "fag",
      "info": "фагготрия, богини",
      "last_num": 6924268,
      "name": "Фагготрия",
      "speed": 734,
      "threads": 105,
      "unique_posters": 2194
    },
    ...
  ]
}
```

## Список "пользовательских" досок

https://2ch.hk/userboards.json

```js
{
  "boards": [{
    "id": "2d",
    "info": "Щитпостинг, обсуждение вайфу, аватарки и прочее. Анимешный /b/, постинг 3d не приветствуется.",
    "last_num": "793813",
    "name": "Аниме/Беседка",
    "speed": 15, // количество постов в час
    "threads": 401
    },
    ...
  ]
}
```

## Список досок (по категориям)

https://2ch.hk/makaba/mobile.fcgi?task=get_boards

```js
{
  "Взрослым": [{
    "bump_limit": 500,
    "category": "Взрослым",
    "default_name": "Аноним", // "уточка"
    "id": "fag",
    "name": "Фагготрия",
    "pages": 7,
    "icons": [{
      "name": "﻿Амкар",
      "num": 1,
      "url": "/icons/logos/amkar.png"
    }, ...]
  },
  ...],
  "Пользовательские": [{
    ...
  },
  ...],
  ...
}
```

## Поиск по темам доски (и ОП-постам)

https://2ch.hk/b/catalog_num.json

```js
{
  "threads": [{
    "subject": "...",
    "comment": "...",
    "author": "...",
    "files": [],
    "posts_count": 5 // количество "ответов"
  }, ...]
}
```

## Поиск по всем постам доски

https://2ch.hk/makaba/makaba.fcgi

FormData:

```
board: b
task: search
find: текст
```

## Прочее

### Флаги

```
"enable_flags": 1
post: { ... "icon": "<img hspace=\"3\" src=\"/flags/KR.png\" border=\"0\" />", ... }
```

### "Трипкоды"

```
"trip": "!!%adm%!!" — админ двача (мб обезьяну).
"trip": "!!%mod%!!" — модератор двача (шериф в пакете, или полиция мб)
```

### Стикеры.

Список стикеров - https://2ch.hk/makaba/stickers/

Добавить свой стикер пак - https://2ch.hk/makaba/stickers/editor

После создания стикер пака и загрузки изображений, необходимо нажать "Активировать", чтобы стикер пак был доступен всем для поиска.

Стикер паки владелец может обновлять, добавлять и удалять из них стикеры, а также удалить вовсе.
Измененный пак обновляется автоматически раз в сутки или можете обновить вручную, если видите что в нем появились новые изображения, нажав в окошке со стикерами U

Стикер вызывается через кнопку S в окошке поста.

Один пост = один стикер. Можно добавлять .gif, которые автоматически проигрываются в превью. .png автоматически отображаются прозрачными.

Стикеры доступны как для анонов (можно использовать до 5 паков), так и для пасскодобояр (без лимита).

Создавать паки могут абсолютно все.

Для загрузки изображение PNG/GIF должно вписываться в квадрат 512x512 (одна сторона — от 200 до 512 пикселей, другая — 512 или меньше, но не менее 50)

