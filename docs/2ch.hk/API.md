# 2ch.hk API

## Определения

### Post

```js
{
  "num": 29102706, // id поста.
  "timestamp": 1549035324, // Дата написания поста ("unix time").
  "date": "01/02/19 Птн 18:35:24", // "Человекочитаемая" дата написания поста.
  "op": 0, // Если "1", то данный пост написан человеком, создавшим тред с галкой "ОП треда", и запостившим это сообщения с галкой "ОП треда".
  "name": "Аноним", // Имя автора поста.
  "email": "", // "email" автора поста (с префиксом "mailto:"). Пример: "mailto:sage".
  "trip": "", // "Трип-код" автора поста. Для администраторов и модераторов тут ставится соответствующая метка.
  "subject": "Четырнадцатый двачкап", // "Тема" поста.
  "comment": "Скинул на почту", // HTML-код комментария.
  "files": [], // Список объектов типа `Attachment`.

  "banned": 0, // Забанен ли автор поста за данный пост.
  "closed": 0, // Закрыт ли тред.
  "endless": 0, // "Тонет" ли этот тред. "Не тонущие" треды помечены единицей.

  "lasthit": 1549117714, // `timestamp` комментария, который является (на текущее время) "последним", "бампающим" данный тред. Например, первый комментарий в треде, или 500-ый комментарий в треде с "бамп-лимитом" в 500 и количеством постов больше 500. Одно и то же значение у всех постов треда.
  "sticky": 0, // Закреплён ли этот тред наверху в списке тредов доски. Если не ноль, то будет порядковым номером закреплённого поста. Пример: "1" располагается выше "2".

  "tags": "lolcup", // (только у первого поста треда) Теги треда.

  "parent": "0", // id треда данного поста. "0" для первого поста треда, для остальных постов — одно и то же значение (id треда, он же id первого поста треда).

  // Только для API "Список постов треда":
  "number": 1, // Порядковый номер поста в треде.

  // Только для тредов с "лайками":
  "likes": 1, // Количество "лайков" у поста.
  "dislikes": 1, // Количество "дизлайков" у поста.
}
```

### Thread

id треда — это id первого поста треда.

```js
{
  "posts": [] // Список объектов типа `Post`.
}
```

### Attachment

Картинка или видео, прикреплённые к посту.

```js
{
  "type": 2, // Тип файла (1 — jpeg, 2 — png, 4 — gif, 6 - webm, 10 — mp4, 100 — png стикер).
  "nsfw": 0, // Помечена ли эта картинка как "NSFW" ("18+").
  "size": 1611, // Размер картинки или видео в килобайтах.

  "width": 1363, // Ширина картинки или видео.
  "height": 768, // Высота картинки или видео.

  "displayname": "photo2018-10-27[...]..png", // Имя файла (ограниченное по длине).
  "fullname": "photo2018-10-2705-29-50.png", // Имя файла.
  "name": "15490353246680.png", // Имя файла на сервере.
  "path": "/vg/src/29102706/15490353246680.png", // URL картинки или видео.

  "md5": "bc441048422b76dd41d626e1420fa0f7", // MD5 хеш файла.

  "thumbnail": "/vg/thumb/29102706/15490353246680s.jpg", // URL уменьшенной картинки.
  "tn_width": 250, // Щирина уменьшенной картинки.
  "tn_height": 140, // Высота уменьшенной картинки.

  // Только для видео:
  "duration": "00:00:53", // "Человекочитаемая" длительность видео.
  "duration_secs": 53 // Длительность видео в секундах.
}
```

## Адреса API

### Список постов треда

https://2ch.hk/<доска>/res/<номер-треда>.json

```js
{
  "Board": "vg", // id доски.
  "BoardInfo": "Доска для постоянных тредов по игре",
  "BoardInfoOuter": "Видеоигры, general, официальные треды", // хз
  "BoardName": "Video Games General", // Название доски.

  "advert_top_image": "/banners/bDpQCWt8xPTuC43S.jpg", // Рекламный баннер сверху.
  "advert_top_link": "/banners/bDpQCWt8xPTuC43S/", // Рекламный баннер сверху.

  "advert_bottom_image": "/banners/AZMtfxdMbkGwpPXB.jpg", // Рекламный баннер снизу.
  "advert_bottom_link": "/banners/AZMtfxdMbkGwpPXB/", // Ссылка рекламного баннера снизу.

  "advert_mobile_image": "/banners/S4BcqS4adse3B2Cb.jpg", // Рекламный баннер (мобильные устройства).
  "advert_mobile_link": "/banners/S4BcqS4adse3B2Cb/", // Рекламный баннер (мобильные устройства).

  "current_thread": "12345", // id запрошенного треда.
  "posts_count": 123, // Количество постов в треде.
  "unique_posters": 7, // Возможно, количество уникальных пользователей, написавших комментарий в треде.
  "files_count": 3, // Сколько файлов запощено в тред суммарно.

  "title": "...", // Название треда. Видимо, то же самое, что `posts[0].subject`.

  "threads": [{
    "posts": [] // Список объектов типа `post`.
  }],

  "bump_limit": 1000, // Сколько постов можно написать в тред до тех пор, пока он не перестанет от них "бампаться" (подниматься).
  "default_name": "Аноним", // Имя автора поста по умолчанию.

  "is_board": 0, // `0` для тредов, `1` для досок.
  "is_closed": 0, // Закрыт ли тред.
  "is_index": 0, // `1` для ответа API списка досок.

  "enable_dices": 0,
  "enable_flags": 0, // Показываются ли флаги у постов треда.
  "enable_icons": 0,
  "enable_images": 1,
  "enable_likes": 0, // Ставятся ли в этом треде лайки/дизлайки.
  "enable_names": 0,
  "enable_oekaki": 0,
  "enable_posting": 1,
  "enable_sage": 0,
  "enable_shield": 0,
  "enable_subject": 1,
  "enable_thread_tags": 1,
  "enable_trips": 0,
  "enable_video": 1,

  "max_comment": 15000, // Максимальная длина комментария.
  "max_files_size": 40960, // Максимальный размер прикрепляемого файла.
  "max_num": 3489385, // id самого "последнего" (на текущий момент) поста в треде.

  "board_banner_image": "/ololo/kpop_7.gif", // Баннер случайной доски.
  "board_banner_link": "kpop", // Ссылка баннера случайной доски.
}
```

### Список постов треда, начиная с id поста

https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=1&num=1

Параметры:

* `board` — id доски.
* `thread` — id треда.
* `num` — id поста, начиная с корого будет список постов в ответе.

Ответ: Список объектов типа [`Post`](#post).

### Список постов треда, начиная с порядкового номера поста в треде

https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=39220&post=252

Параметры:

* `board` — id доски.
* `thread` — id треда.
* `num` — порядковый номер поста в треде, начиная с корого будет список постов в ответе.

Ответ: Список объектов типа [`Post`](#post).

### Список тредов доски

https://2ch.hk/<доска>/<номер-страницы>.json

Параметры:

* `<номер-страницы>` — `index` для первой страницы, далее `1`, `2`, ...

```js
{
  "Board": "b",
  "BoardInfo": "",
  // И все остальные поля, как у треда.
  "is_board": 1,
  "pages": [0, 1, 2, 3, ...], // Список страниц тредов доски.
  "threads": [{
    "files_count": 0, // Количество файлов, прикреплённых к постам треда (суммарно).
    "posts_count": 27, // Количество постов в треде.
    "thread_num": "3475861", // id треда.
    "posts": [] // Список объектов типа `post`.
  }]
}
```

### Список тредов доски с сортировкой по дате последнего поста

https://2ch.hk/<доска>/catalog.json

Выводит список тредов, упорядоченных по дате "последнего" (на текущий момент) поста в них (самые новые — сверху).

`threads` — список "тредов", где "тред" — первый пост треда, то есть объект типа [`Post`](#post)

```js
{
  "threads": [] // Список объектов типа `Post`.
}
```

### Список тредов доски с сортировкой по времени создания треда

https://2ch.hk/<доска>/catalog_num.json

```js
{
  "Board": "b",
  "BoardInfo": "",
  // И все остальные поля, как у треда.
  "threads": [] // Список объектов типа `Post`.
}
```

### Список тредов доски (облегченный вариант, с просмотрами и рейтингом для "топа тредов")

https://2ch.hk/<доска>/threads.json

```js
{
  threads: [{
    "num": "3475861", // id треда.
    "score": 17.8347107438, // "Рейтинг" треда.
    "views": 2159, // Количество просмотров треда.
    "posts_count": 374, // Количество постов в треде.
    "timestamp": 1540597950, // Дата создания треда (unix timestamp).
    "subject": "Во что играем?", // Тема треда.
    "comment": "ИТТ описываем свои похождения, ...", // Первый пост треда.
    "lasthit": 1541028071, // Видимо, то же самое, что `lasthit` у объекта типа `Post`.
  },
  ...]
}
```

### Список досок

https://2ch.hk/boards.json

```js
{
  "global_boards": 158, // Количество досок.
  "global_posts": "363,061,097\u0000", // Количество постов на дваче.
  "global_speed": "1,406\u0000", // Количество постов на дваче в час.
  "is_index": 1, // Видимо, всегда `1`.
  "boards": [
    {
      "bump_limit": 500,
      "category": "Разное",
      "default_name": "Аноним",
      "enable_names": 0,
      "enable_sage": 1,
      "id": "b",
      "info": "бред",
      "last_num": 190778973,
      "name": "Бред",
      "speed": 2690, // Количество постов на доске в час.
      "threads": 210,
      "unique_posters": 4137
    },
    {
      "bump_limit": 500,
      "category": "Взрослым",
      "default_name": "Аноним",
      "enable_names": 1,
      "enable_sage": 1,
      "id": "fag",
      "info": "фагготрия, богини",
      "last_num": 6924268,
      "name": "Фагготрия",
      "speed": 734, // Количество постов на доске в час.
      "threads": 105,
      "unique_posters": 2194
    },
    ...
  ]
}
```

### Список "пользовательских" досок

https://2ch.hk/userboards.json

```js
{
  "boards": [{
    "id": "2d",
    "info": "Щитпостинг, обсуждение вайфу, аватарки и прочее. Анимешный /b/, постинг 3d не приветствуется.",
    "last_num": "793813",
    "name": "Аниме/Беседка",
    "speed": 15, // Количество постов на доске в час.
    "threads": 401
  },
  ...]
}
```

### Список досок (по категориям)

https://2ch.hk/makaba/mobile.fcgi?task=get_boards

```js
{
  "Взрослым": [{
    "bump_limit": 500,
    "category": "Взрослым",
    "default_name": "Аноним", // "уточка"
    "id": "fag",
    "name": "Фагготрия",
    "pages": 7,
    "icons": [{
      "name": "﻿Амкар",
      "num": 1,
      "url": "/icons/logos/amkar.png"
    }, ...]
  },
  ...],
  "Пользовательские": [{
    ...
  },
  ...],
  ...
}
```

### Поиск по темам доски (и ОП-постам)

https://2ch.hk/b/catalog_num.json

```js
{
  "threads": [{
    "subject": "...",
    "comment": "...",
    "author": "...",
    "files": [],
    "posts_count": 5 // количество "ответов"
  }, ...]
}
```

### Поиск по всем постам доски

https://2ch.hk/makaba/makaba.fcgi

`FormData`:

* `board` — "b"
* `task` — "search"
* `find` — "текст"

## Прочее

### Флаги

Если у треда `"enable_flags": 1`, то у постов будет поле `icon`:

```js
{
  "icon": "<img hspace=\"3\" src=\"/flags/KR.png\" border=\"0\" />"
}
```

### Трипкоды

Поле `trip` у поста.

* `"!!%adm%!!"` — Администратор.
* `"!!%mod%!!"` — Модератор.

### Стикеры.

Список стикеров - https://2ch.hk/makaba/stickers/

Добавить свой стикер пак - https://2ch.hk/makaba/stickers/editor

После создания стикер пака и загрузки изображений, необходимо нажать "Активировать", чтобы стикер пак был доступен всем для поиска.

Стикер паки владелец может обновлять, добавлять и удалять из них стикеры, а также удалить вовсе.
Измененный пак обновляется автоматически раз в сутки или можете обновить вручную, если видите что в нем появились новые изображения, нажав в окошке со стикерами U

Стикер вызывается через кнопку S в окошке поста.

Один пост = один стикер. Можно добавлять .gif, которые автоматически проигрываются в превью. .png автоматически отображаются прозрачными.

Стикеры доступны как для анонов (можно использовать до 5 паков), так и для пасскодобояр (без лимита).

Создавать паки могут абсолютно все.

Для загрузки изображение PNG/GIF должно вписываться в квадрат 512x512 (одна сторона — от 200 до 512 пикселей, другая — 512 или меньше, но не менее 50)